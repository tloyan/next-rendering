# Dynamic Rendering - Cookies - Headers - Fetch

### ğŸ’¡ Dynamic Rendering - Cookies - Headers - Fetch

## ğŸ“ Tes notes

DÃ©taille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Nous allons aborder 3 autres maniÃ¨res de rendre nos `RSC` Dynamiques.

- Via lâ€™accÃ¨s au headers (http)
- Via lâ€™accÃ¨s aux cookies (http)
- Via `Fetch` (option)

Pour accÃ©der aux Headers Http :

```tsx
import {headers} from 'next/headers'
...
const headersList = headers()
const referer = headersList.get('referer')
```

ğŸ“‘ Le lien vers la doc [https://nextjs.org/docs/app/api-reference/functions/cookies](https://nextjs.org/docs/app/api-reference/functions/cookies)

Pour accÃ©der aux Cookies :

```tsx
import {cookies} from 'next/headers'
...
const cookieStore = cookies()
```

ğŸ“‘ Le lien vers la doc [https://nextjs.org/docs/app/api-reference/functions/headers](https://nextjs.org/docs/app/api-reference/functions/headers)

## Exercice

ğŸ‘¨â€âœˆï¸ Hugo, le chef de projet, nous informe que nous allons devoir filtrer les `posts` aux personnes qui sont connectÃ©es uniquement (qui ont un `cookies` avec `userid`).

Pour simuler les cookies tu peux aller dans Chrome / Inspecter / Application / Cookies et ajouter un cookie

![Untitled](/course/Untitled.png)

```tsx
[Set cookies](/course/cookies.png)
```

- ğŸ¶ Adapte le composant actuel qui a un rendu statique en rendu dynamique en vÃ©rifiant la prÃ©sence des cookies
- Si pas de cookies `userid`â€”> pas de `post`
- Si cookies `userid`â€”> affichage des `posts`

Fichiers

- `/exercises/dynamic-rendering/cookies-headers/page.tsx`

## Bonus

### 1. ğŸš€ Rendu Dynamique avec Headers

ğŸ‘¨â€âœˆï¸ Hugo, le chef de projet, te demande une rÃ¨gle un peu spÃ©ciale. Il te demande de ne pas afficher de `post` sur une version particuliÃ¨re du navigateur en se basant sur le `user-agent`. Tu peux retrouver les valeurs dans la requÃªte HTTP

![Untitled](/course/Untitled1.png)

```tsx
[Set cookies](/course/useragent.png)
```

Pour filtrer la version 126, tu peux par exemple faire :

```tsx
!userAgent?.includes('Chrome/126.0.0.0')
```

ğŸ¶ Adapte le code pour filtrer ta version de navigateur

- Si pas ta version â€”> pas de `post`
- Si autres versions â€”> affichage des `posts`

Fichiers

- `/exercises/dynamic-rendering/cookies-headers/page.tsx`

### 2. ğŸš€ Fetch

[Lâ€™API Fetch](https://developer.mozilla.org/fr/docs/Web/API/Fetch_API/Using_Fetch) a des options pour garder les donnÃ©es en cache. (Mais il sâ€™agit de la mÃ©moire cache du navigateur)

[Next Ã©tends](https://nextjs.org/docs/app/api-reference/functions/fetch) lâ€™[api Fetch](https://developer.mozilla.org/fr/docs/Web/API/Fetch_API/Using_Fetch) permet de rÃ©cupÃ©rer les donnÃ©es distantes et gÃ©rer les donnÃ©es en cache mais cÃ´tÃ© serveur.

```tsx
export default async function Page() {
  // This request should be cached until manually invalidated.
  // Similar to `getStaticProps`.
  // `force-cache` is the default and can be omitted.
  const staticData = await fetch(`https://...`, {cache: 'force-cache'})

  // This request should be refetched on every request.
  // Similar to `getServerSideProps`.
  const dynamicData = await fetch(`https://...`, {cache: 'no-store'})

  // This request should be cached with a lifetime of 10 seconds.
  // Similar to `getStaticProps` with the `revalidate` option.
  const revalidatedData = await fetch(`https://...`, {
    next: {revalidate: 10},
  })

  return <div>...</div>
}
```

<aside>
ğŸ’¡ Depuis Next 15.0.0 : Default cache option was changed from `'force-cache'` to `'no-storeâ€™`

</aside>

Dans cet exercice bonus, supprime lâ€™appel Ã  `getPosts` et remplace le par un `fetch`

```tsx
const data = await fetch('https://jsonplaceholder.typicode.com/posts', ...
//pense a tester les otions pour faire un rendu statique et dynamique
const posts = await data.json()
```

Constate lors de la compilation le changement de mode de rendu Æ’ :

```tsx
â”œ Æ’ /exercises/dynamic-rendering/cookies-headers  154 B          88.5 kB
â”œ â—‹ /exercises/static-rendering                   154 B          88.5 kB
+ First Load JS shared by all                     88.4 kB
  â”œ chunks/162-85a026428100bb9c.js                32.1 kB
  â”œ chunks/92b01630-b398710d6ee562b5.js           54.4 kB
  â”” other shared chunks (total)                   1.86 kB

â—‹  (Static)   prerendered as static content
â—  (SSG)      prerendered as static HTML (uses getStaticProps)
Æ’  (Dynamic)  server-rendered on demand
```

Fichiers

- `/exercises/dynamic-rendering/cookies-headers/page.tsx`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-functions](https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-functions)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=04%20Rendering%20AvancÃ©e&entry.533578441=03%20dynamic-rendering-cookies).
