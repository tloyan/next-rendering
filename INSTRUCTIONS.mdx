# Dynamic Rendering (dynamic functions)

### ğŸ’¡ Comprendre le rendu dynamique

## ğŸ“ Tes notes

DÃ©taille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

La deuxiÃ¨me stratÃ©gie de rendu cÃ´tÃ© serveur des `RSC` est le rendu dynamique. Contrairement au rendu statique, le rendu dynamique rÃ©gÃ©nÃ¨re une nouvelle page sur chaque requÃªte.

Ici nous allons explorer le rendu dynamique des composants serveur `React` avec `Next.js`. GrÃ¢ce au rendu dynamique, les routes sont gÃ©nÃ©rÃ©es Ã  la demande pour chaque utilisateur, ce qui permet de personnaliser les donnÃ©es en fonction des informations spÃ©cifiques Ã  chaque requÃªte, comme les `cookies` ou les paramÃ¨tres de recherche de l'URL.

Cette approche est particuliÃ¨rement utile pour les sites web qui combinent des donnÃ©es mises en cache et des donnÃ©es non mises en cache, comme les pages de commerce Ã©lectronique. `Next.js` gÃ¨re automatiquement la meilleure stratÃ©gie de rendu pour chaque route, en tenant compte des fonctionnalitÃ©s et des `API` utilisÃ©es, vous permettant ainsi de vous concentrer sur la mise en cache et la revalidation des donnÃ©es spÃ©cifiques.

ğŸ“‘ Le lien vers la doc [https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-rendering](https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-rendering)

ConcrÃ¨tement, pour switcher vers du rendu dynamique, il faut soit :

- Utiliser des [fonctions dynamiques](https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-rendering) (donnÃ©es dÃ©pendantes de chaque requÃªte)
- Demander [le `uncache` des donnÃ©es.](https://nextjs.org/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating#opting-out-of-data-caching)

| **Dynamic Functions** | **Data**   | **Route**            |
| --------------------- | ---------- | -------------------- |
| No                    | Cached     | Statically Rendered  |
| Yes                   | Cached     | Dynamically Rendered |
| No                    | Not Cached | Dynamically Rendered |
| Yes                   | Not Cached | Dynamically Rendered |

## Exercice

Les fonctions dynamiques reposent sur des informations qui ne peuvent Ãªtre connues qu'au moment de la requÃªte, telles que les cookies d'un utilisateur, les en-tÃªtes de requÃªtes en cours ou les paramÃ¨tres de recherche de l'URL. Dans `Next.js`, ces `API` dynamiques

- [`cookies()`](https://rc.nextjs.org/docs/app/api-reference/functions/cookies)
- [`headers()`](https://rc.nextjs.org/docs/app/api-reference/functions/headers)
- [`unstable_noStore()`](https://rc.nextjs.org/docs/app/api-reference/functions/unstable_noStore)
- [`unstable_after()`](https://rc.nextjs.org/docs/app/api-reference/functions/unstable_after):
- [`params`](https://nextjs.org/docs/app/api-reference/file-conventions/page#searchparams-optional) et [`searchParams`](https://nextjs.org/docs/app/api-reference/file-conventions/page#searchparams-optional)Â [prop](https://rc.nextjs.org/docs/app/api-reference/file-conventions/page#searchparams-optional)

Dans cet exercice tu vas devoir crÃ©er un `React Serveur Component` qui affiche un `post` en particulier. Comme sur un blog, le nombre de post peut augmenter et il nâ€™est pas possible de prÃ©dire Ã  la compilation le nombre de `posts` total. Tu vas donc devoir faire du rendu dynamique.

Les segments de routes dynamiques comme la nÃ´tre : [`exercises/dynamic-rendering/[id]`](exercises/dynamic-rendering/1) vont crÃ©er automatiquement des rendus dynamiques.

Appelle la fonction dynamique `getPostById` pour afficher un post particulier.

```tsx
import {getPostById} from '@/db/sgbd'
const post = await getPostById(params.id)
```

_PS : pense Ã  gÃ©rer le cas oÃ¹ le post nâ€™est pas trouvÃ©._

Fichiers

- `exercise/dynamic-rendering/[id]/page.tsx`

## Bonus

### 1. ğŸš€ PrÃ©-gÃ©nÃ©ration de pages dynamiques (generateStaticParams)

Les appels aux sources de donnÃ©es et le rendu cÃ´tÃ© serveur peuvent parfois Ãªtre longs. Pour simuler cela dans notre page, nous allons utiliser le bout de code suivant :

```tsx
const Page = async ({params}: {params: {id: string}}) => {
  //2 secondes latency
  await new Promise((resolve) => setTimeout(resolve, 2000))
  ...

```

- ğŸ‘¨â€âœˆï¸ Hugo, le chef de projet, te demande de prÃ©-gÃ©nÃ©rer les pages contenant des `posts` grÃ¢ce Ã  la fonction `generateStaticParams`

```tsx
//page.tsx
export function generateStaticParams() {
  return [{id: '1'}, {id: '2'}, {id: '3'}]
}
```

- ğŸ¶RÃ©cupÃ¨re la liste des `posts` avec `getPosts` de `'@/db/sgbdâ€™` et retourne tous les ids.

<aside>
ğŸ’¡ Constate avec la commande `build` que les routes `/exercises/dynamic-rendering/x` sont prÃ©-gÃ©nÃ©rÃ©es.

</aside>

```tsx
â”œ â—‹ /exercises/dynamic-rendering         175 B          95.3 kB
â”œ â— /exercises/dynamic-rendering/[id]    146 B          88.5 kB
â”œ   â”œ /exercises/dynamic-rendering/1
â”œ   â”œ /exercises/dynamic-rendering/2
â”œ   â”œ /exercises/dynamic-rendering/3
â”œ   â”” [+3 more paths]
â”œ â—‹ /exercises/static-rendering          146 B          88.5 kB
â”” â—‹ /instructions
```

<aside>
ğŸ’¡ Constate que lâ€™affichage est rapide malgrÃ© la latence simulÃ©e

</aside>

Fichiers

- `exercise/dynamic-rendering/[id]/page.tsx`

### 2. ğŸš€ Revalidation

ğŸ‘¨â€âœˆï¸ Hugo, le chef de projet, nous indique que les `posts` peuvent Ãªtre mis Ã  jour de temps en temps par les rÃ©dacteurs. Mais dans le cas actuel, une fois les pages gÃ©nÃ©rÃ©es, elles ne sont plus mises Ã  jour en cas de changement de donnÃ©es en BDD. (fais le test en changeant le `title` dans `db.json`)

Ajoute le bout de code qui permet une revalidation des donnÃ©es aprÃ¨s X secondes.

ğŸ“‘ Le lien vers la doc : [https://nextjs.org/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating#time-based-revalidation](https://nextjs.org/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating#time-based-revalidation)

Fichiers

- `exercise/dynamic-rendering/[id]/page.tsx`

### 3. ğŸš€ Search Params

ğŸ‘¨â€âœˆï¸ Hugo, le chef de projet, te demande de faire une autre route dans laquelle nous allons pouvoir filtrer des `posts` en `query params`, par exemple avec `filter` et `text`[?filter=title&text=superpost](http://localhost:3000/exercises/dynamic-rendering/search-params?filter=title&text=a)

- `filter` : le champ Ã  filtrer.
- `text` : le terme de recherche.

Pour avoir des `query params`, il faut utiliser ces `props` :

```tsx
const Page = async ({
  searchParams,
}: {
  searchParams: {[key: string]: string | string[] | undefined}
}) => {
```

- **ğŸ¶ Le composant :** `exercise/dynamic-rendering/search-params/page.tsx` est statique par dÃ©fault. (Constate le avec un `build/start` de production).
- Adapte le pour le rendre dynamique grÃ¢ce au `searchParams` et constate le rendu dynamique en production.

Fichiers

- `exercise/dynamic-rendering/search-params/page.tsx`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://nextjs.org/docs/app/building-your-application/rendering/server-components#switching-to-dynamic-rendering](https://nextjs.org/docs/app/building-your-application/rendering/server-components#switching-to-dynamic-rendering)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=04%20Rendering%20AvancÃ©e&entry.533578441=02%20dynamic-rendering-function).
