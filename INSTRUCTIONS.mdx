# Streaming (Loading et Skeleton)

### ğŸ’¡ Comprendre le Streaming (Loading et Skeleton)

## ğŸ“ Tes notes

DÃ©taille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Dans ce module, nous abordons le rendu streaming, une technique qui permet de rendre progressivement l'interface utilisateur cÃ´tÃ© serveur.

Cette approche dÃ©coupe le travail en segments, les diffusant au client dÃ¨s qu'ils sont prÃªts. Ainsi, l'utilisateur peut visualiser des parties de la page immÃ©diatement, mÃªme si tout le contenu n'est pas encore complÃ¨tement rendu.

Le streaming intÃ©grÃ© au routeur d'application de `Next.js` amÃ©liore la performance de chargement initial des pages et facilite l'affichage d'interfaces dÃ©pendant de rÃ©cupÃ©rations de donnÃ©es lentes.

`Sequential` vs `Paralell` :

![sequential-parallel-data-fetching.avif](/course/sequential-parallel-data-fetching.avif)

Partiel content

![server-rendering-with-streaming.avif](/course/server-rendering-with-streaming.avif)

ğŸ“‘ Le lien vers la doc [https://nextjs.org/docs/app/building-your-application/rendering/server-components#streaming](https://nextjs.org/docs/app/building-your-application/rendering/server-components#streaming)

## Exercice

Dans cet exercice, nous avons des composants (`RSC`) qui sont longs Ã  charger (plusieurs secondes).

- `<ProductList>` â€”> 2 secondes
- `<PostList>` â€”> 5 secondes

Ces composants sont chargÃ©s dans un `Dashboard` sur le segment de route : [/exercises/streaming](http://localhost:3000/exercises/streaming)

![streaming-exca.png](/course/streaming-exca.png)

**ğŸ‘¨â€âœˆï¸ Hugo, le chef de projet,** demande de rendre le contenu du `dashboard` ([/exercises/streaming](http://localhost:3000/exercises/streaming)) non bloquant (comme câ€™est le cas actuellement).

### Pourquoi c'est bloquant :

Pour comprendre pourquoi câ€™est bloquant, il est utile de comprendre le rendu cÃ´tÃ© serveur (`SSR`) et ses limites.

Avec le `SSR`, plusieurs Ã©tapes doivent Ãªtre complÃ©tÃ©es avant que l'utilisateur puisse voir et interagir avec une page :

- **RÃ©cupÃ©ration des donnÃ©es :** Toutes les donnÃ©es pour une page donnÃ©e sont rÃ©cupÃ©rÃ©es sur le serveur.
- **Rendu HTML :** Le serveur gÃ©nÃ¨re le `HTML` pour la page.
- **Envoi au client :** Le `HTML`, le `CSS` et le `JavaScript` de la page sont envoyÃ©s au client.
- **Affichage initial :** Une interface utilisateur non interactive est affichÃ©e Ã  l'aide du `HTML` et du `CSS` gÃ©nÃ©rÃ©s.
- **Hydratation par `React` :** Enfin, `React` hydrate l'interface utilisateur pour la rendre interactive.

![server-rendering-without-streaming-chart.avif](/course/server-rendering-without-streaming-chart.avif)

Comme le `fetching` de data serveur et `rendrering` peut Ãªtre long, `Next` permet dâ€™avoir un fichier `loading.tsx` au niveau du segment de route, cela permet dâ€™avoir un `FCP` rapide.

ğŸ“‘ Voir la doc : https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming

ğŸ¶ Dans cet exercice, tu vas devoir crÃ©er un fichier `loading.tsx` au niveau de la route afin dâ€™afficher un `Skeleton` le temps que toutes les donnÃ©es soient chargÃ©es

```tsx
import {Skeleton} from '@/components/ui/skeleton'
...
<div className="m-4 mx-auto max-w-4xl p-6 text-lg">
  <Skeleton className="m-4  h-[325px] rounded-xl" />
  <div className="m-4 space-y-2">
    <Skeleton className="h-4" />
    <Skeleton className="h-4 " />
  </div>
</div>
```

Fichiers

- `src/app/exercises/streaming/loading.tsx`

## Bonus

### 1. ğŸš€ AmÃ©lioration (Streaming avec Suspense)

Avoir un composant de chargement permet de rendre la page non bloquante, mais il faut toujours attendre le chargement complet des composants pour avoir lâ€™affichage complet.

- `<ProductList>` â€”> 2 secondes
- `<PostList>` â€”> 5 secondes

Le streaming permet dâ€™avoir accÃ¨s aux composants directement lorsqu'ils sont disponibles.

Pour cela il faut les composant dans un `Suspense` exemple :

```tsx
import {Suspense} from 'react'
import {PostFeed, Weather} from './Components'

export default function Posts() {
  return (
    <section>
      <Suspense fallback={<p>Loading feed...</p>}>
        <PostFeed />
      </Suspense>
      <Suspense fallback={<p>Loading weather...</p>}>
        <Weather />
      </Suspense>
    </section>
  )
}
```

ğŸ“‘ Doc Suspense https://react.dev/reference/react/Suspense

ğŸ¶ Dans cet exercice, utilise `suspense` pour afficher des `squeleton` le temps que les composants soient accessibles.

Constate que le `loading` nâ€™est plus nÃ©cessaire

Fichiers

- `src/app/exercises/streaming/page.tsx`

### 2. ğŸš€ Streaming et `loading.tsx`

Simule un accÃ¨s long aux donnÃ©es de la page du `dashboard` (ce qui peut arriver si des donnÃ©es sont lentes Ã  charger sur la page principale)

```tsx
const username = 'Mike Codeur'
await new Promise((resolve) => setTimeout(resolve, 1000))
```

Fichiers

- `src/app/exercises/streaming/page.tsx`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://nextjs.org/docs/app/building-your-application/rendering/server-components#streaming](https://nextjs.org/docs/app/building-your-application/rendering/server-components#streaming)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=04%20Rendering%20AvancÃ©e&entry.533578441=05%20streaming).
