# Client Component - External Librairy

### ğŸ’¡ Comment utiliser des librairies externes (client Component)

## ğŸ“ Tes notes

Detaille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Les **React Serveur Components (RSC)** ont de nombreux avantages:

- **Optimisation du rendu initial :** Ils permettent d'optimiser le rendu initial en Ã©vitant de transfÃ©rer du code JavaScript non utilisÃ©.
- **RÃ©duction du temps de chargement :** En limitant les transferts de donnÃ©es, ils rÃ©duisent le temps de chargement initial des pages.
- **Meilleure gestion des ressources :** Ils facilitent une meilleure gestion des ressources cÃ´tÃ© serveur en minimisant le travail rÃ©pÃ©titif.
- **AmÃ©lioration de la sÃ©curitÃ© :** En rÃ©duisant l'exposition du code client, ils amÃ©liorent la sÃ©curitÃ© de l'application.
- **Meilleure expÃ©rience utilisateur :** En permettant un chargement plus rapide et une interface plus rÃ©active, ils amÃ©liorent l'expÃ©rience globale des utilisateurs.

**Cependant il ne peuvent pas tout faire :**

Nous avons toujours besoins de React Client Component (RCC) pour :

- **InteractivitÃ© :** Les composants cÃ´tÃ© client peuvent utiliser l'Ã©tat, les effets et les Ã©couteurs d'Ã©vÃ©nements, ce qui leur permet de fournir un retour immÃ©diat Ã  l'utilisateur et de mettre Ã  jour l'interface utilisateur.
- **APIs du navigateur :** Les composants cÃ´tÃ© client ont accÃ¨s aux APIs du navigateur, comme la `gÃ©olocalisation` ou `localStorage`.

Avec Next JS, tous les composants React **sont considÃ©rÃ©s comme RSC par dÃ©faut.** Pour pouvoir bÃ©nÃ©ficier des avantages des RCC il faut explicitement les dÃ©finir comme client avec la directive `'use client'`

```tsx
'use client'
import { useState } from 'react'

export default function Counter() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

Si le dÃ©veloppeur oublie la directive Next va dÃ©tecter que câ€™est du code client et va gÃ©nÃ©rer une erreur

![use-client-directive.avif](/course/use-client-directive.avif)

ğŸ“‘ Le liens vers la doc [https://nextjs.org/docs/app/building-your-application/rendering/client-components](https://nextjs.org/docs/app/building-your-application/rendering/client-components)

## Exercice

Commet nous lâ€™avons vu, ajouter du code client sans la directive `â€˜use clientâ€™` gÃ©nÃ¨re une erreur. Ici nous avons un RSC (nous ne pouvons donc pas utiliser la directive `â€˜use clientâ€™`) mais nous voulons inclure des composants enfants clients

```tsx
//RSC
export default async function Page() {
  const posts = await getPosts()
  return (
    <div>
        il y a {posts.length} posts
    </div>
  )
```

Mais nous voulons utiliser un RCC, un simple composant `<Counter />`

ğŸ¶ Ajoute le compteur dans `page.tsx` et adapte le Counter si nÃ©cessaire.

Fichiers

- `/exercises/client-components/page.tsx`
- `/exercises/client-components/rcc-counter.tsx`

## Bonus

### 1. ğŸš€ Librairie externe

Nous utilisons souvent des librairies React externes dans nos projets. Par exemple ici nous avons une librairies externe

```tsx
//npm install
//car depend de la libriaire react-use
import ExternalLib from '@/lib/externalClientLib'
...
<ExternalLib defaultDelay={100} />
```

Nous ne pouvons pas ajouter la directive `â€˜use clientâ€™` dessus car il sâ€™agit dâ€™une librairie externe.

- ğŸ¶ Dans un premier temps essaye dâ€™utiliser cette libraire en dessous du compteur dans `page.tsx`

```tsx
// exercises/client-components/page.tsx
import ExternalLib from '@/lib/externalClientLib'
...

<Counter />
<ExternalLib defaultDelay={100} />
```

Constate lâ€™erreur

```tsx
Error: useState only works in Client Components. Add the "use client" directive at the top of the file to use it. Read more: https://nextjs.org/docs/messages/react-client-hook-in-server-component
```

### Comment faire pour utiliser un RCC externe sans avoir la main sur le code ?

- Solution un Wrapper contenant `â€˜use clientâ€™`

```tsx
//client-lib-wrapper.tsx
'use client'

export {default} from '@/lib/externalClientLib'
// ou
export * from '@/lib/externalClientLib'
```

- ğŸ¶ Utilise le wrapper `exercises/client-components/client-lib-wrapper.tsx` au lieu de la librairie

Fichiers

- `/exercises/client-components/page.tsx`
- `/exercises/client-components/client-lib-wrapper.tsx`

### 2. ğŸš€ server-only

Nous avons aussi un RCC `<RccFetch>` qui appel un fonction `getData`

```tsx
import {getData} from './data'

export default function RccFetch() {
  const promise = useMemo(() => getData(), [])
  const data: Post[] = use(promise)
  ...
```

Un fetch qui contient des donnÃ©es sensible comme un token

```tsx
export async function getData() {
  const secretKey = '#######_this_is_a_secret_key_#######'
  const res = await fetch('https://jsonplaceholder.typicode.com/posts', {
    headers: {
      authorization: secretKey,
    },
  })

  return res.json()
}
```

Il existe un module pour interdire de faire cela : `â€œserver-onlyâ€`

```tsx
import 'server-only'
```

Ce module va dÃ©clencher un erreur en cas dâ€™import de code serveur dans le client

Doc [server-only](https://nextjs.org/docs/app/building-your-application/data-fetching/patterns#using-react-cache-server-only-and-the-preload-pattern)

- ğŸ¶ Utilise server-only dans le fichier data.ts

Fichiers

- `exercises/client-components/data.ts`
- `/exercises/client-components/page.tsx`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://www.w3schools.com/html/html_css.asp](https://www.w3schools.com/html/html_css.asp)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=Rendering%20AvancÃ©e&entry.533578441=06%20rcc-external-lib).
